---
layout: post
title: http ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ˜ãƒƒãƒ€ã® HOST ã«ã¤ã„ã¦
date: 2018-12-26 08:26:24
tag: [minipost]
---

(å¾Œã‹ã‚‰æ›¸ã„ã¦ã„ã‚‹ã®ã§è‰²ã€…èª¬æ˜ã®é †åºãŒãŠã‹ã—ããªã£ã¦ã„ã‚‹ã‘ã©...)

ç™ºç«¯ã¯ã“ã® PR https://github.com/rails/rails/pull/33145

http ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ˜ãƒƒãƒ€ã«ã‚ã‚‹ `Host` ã¨ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å‘ãå…ˆã¯å®Œå…¨ã«åŒã˜ã‚‚ã®ã¨ã„ã†åˆ¶ç´„ãŒã‚ã‚‹ã®ã‹ã¨æ€ã£ã¦ã„ãŸã®ã§ã€æœ€åˆã¯ä½•ã‚’è¨€ã£ã¦ã‚‹ã®ã‹ã‚ã‹ã‚‰ãªã‹ã£ãŸã€‚ã§ã€èª¿ã¹ã¦ã¿ã‚‹ã¨ã€Œcurl ã‚’å©ãã¨ãã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ã® `Host` ã®å€¤ã‚’å¥½ãã«ã„ã˜ã‚‹ã«ã¯ã€ã¿ãŸã„ãªè¨˜äº‹ã«ãŸã©ã‚Šç€ã„ã¦ã¯ã¯ãƒ¼ã‚“ã¨ãªã£ãŸã€‚

è©¦ã—ã«ãƒ­ãƒ¼ã‚«ãƒ«ã§ã‚µãƒ¼ãƒã‚’ç«‹ã¦ã¦ã¿ã¦

`$ curl localhost:3000 -H 'Host:example.com'`

ã¨ã‹ã£ã¦ã™ã‚‹ã€‚ pry ã§ã‚µãƒ¼ãƒå´ã‚’æ­¢ã‚ã¦ã¿ã¦

```
[1] pry(#<TestController>)> request.env['HTTP_HOST']
=> "example.com"
```

ãªã‚‹ã»ã©ã­ğŸ¤”

ã“ã‚Œã¯ç¢ºã‹ã« Web ã‚µãƒ¼ãƒå´ã¨ã—ã¦ã¯è¨±å®¹ã—ãŸããªã„ã‹ã‚‚ã­ã€‚
(å†’é ­ã«è²¼ã£ãŸ PR ã§è¨€ã£ã¦ã‚‹ `DNS rebinding and other Host header attacks` ãŒä½•ã‚’æŒ‡ã—ã¦ã„ã‚‹ã®ã‹ã‚ã‹ã‚‰ãªã„ã‘ã©...)

ã¡ãªã¿ã« google æ§˜ã¯ã¡ã‚ƒã‚“ã¨ã—ã¦ãŸ(ãã‚Šã‚ƒãã†ã‹)

```
$ curl www.google.com -H 'Host:example.com'
<!DOCTYPE html>
<html lang=en>
  <meta charset=utf-8>
  <meta name=viewport content="initial-scale=1, minimum-scale=1, width=device-width">
  <title>Error 404 (Not Found)!!1</title>
  <style>
    *{margin:0;padding:0}html,code{font:15px/22px arial,sans-serif}html{background:#fff;color:#222;padding:15px}body{margin:7% auto 0;max-width:390px;min-height:180px;padding:30px 0 15px}* > body{background:url(//www.google.com/images/errors/robot.png) 100% 5px no-repeat;padding-right:205px}p{margin:11px 0 22px;overflow:hidden}ins{color:#777;text-decoration:none}a img{border:0}@media screen and (max-width:772px){body{background:none;margin-top:0;max-width:none;padding-right:0}}#logo{background:url(//www.google.com/images/branding/googlelogo/1x/googlelogo_color_150x54dp.png) no-repeat;margin-left:-5px}@media only screen and (min-resolution:192dpi){#logo{background:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) no-repeat 0% 0%/100% 100%;-moz-border-image:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) 0}}@media only screen and (-webkit-min-device-pixel-ratio:2){#logo{background:url(//www.google.com/images/branding/googlelogo/2x/googlelogo_color_150x54dp.png) no-repeat;-webkit-background-size:100% 100%}}#logo{display:inline-block;height:54px;width:150px}
  </style>
  <a href=//www.google.com/><span id=logo aria-label=Google></span></a>
  <p><b>404.</b> <ins>That's an error.</ins>
  <p>The requested URL <code>/</code> was not found on this server.  <ins>That's all we know.</ins>
```
